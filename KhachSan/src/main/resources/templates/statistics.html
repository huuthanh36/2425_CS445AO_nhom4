<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Booking Statistics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,700,900|Rubik:300,400,700" rel="stylesheet">

    <link rel="stylesheet" href="/css/bootstrap.css">
    <link rel="stylesheet" href="/css/animate.css">
    <link rel="stylesheet" href="/css/owl.carousel.min.css">

    <link rel="stylesheet" href="/fonts/ionicons/css/ionicons.min.css">
    <link rel="stylesheet" href="/fonts/fontawesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/css/magnific-popup.css">

    <!-- Theme Style -->
    <link rel="stylesheet" href="/css/style.css">
    <style>


        .chart-container {
            margin: 20px 20px 20px 20px !important;
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap; /* Allow charts to wrap if there's not enough space */
            width: 100%; /* Ensure the container takes the full width */
        }

        .chart-container canvas {
            width: 48%; /* Ensure each chart takes 48% of the container width */
            max-width: 400px; /* Limit the maximum width */
            height: 300px; /* Set a specific height */
            max-height: 300px; /* Limit the maximum height */
            margin: 0 auto; /* Center the chart if there's extra space */
        }

        .content {
            padding-top: 100px; /* Add space between the header and content */
        }
    </style>
</head>
<body>

<div th:insert="~{header :: header}"></div>

<div class="content">
    <div class="chart-container">
        <canvas id="revenueChart"></canvas>
        <canvas id="countChart"></canvas>
    </div>
</div>

<script>
    async function fetchChartData() {
        try {
            const revenueResponse = await fetch('/api/weeklyRevenueLast4Weeks');
            const weeklyRevenueData = await revenueResponse.json();
            console.log('Weekly Revenue for Last 4 Weeks:', weeklyRevenueData);

            const countResponse = await fetch('/api/count?startDate=2024-01-01&endDate=2024-12-31');
            const countData = await countResponse.json();
            console.log('Booking Count:', countData);

            const weeks = Array.from({ length: 4 }, (_, i) => `Week ${i + 1}`);

            if (weeklyRevenueData && countData) {
                // Handle null data in weeklyRevenueData
                const sanitizedWeeklyRevenueData = weeklyRevenueData.map(value => value === null ? 0 : value);

                // Revenue Chart
                const revenueCtx = document.getElementById('revenueChart').getContext('2d');
                const revenueChart = new Chart(revenueCtx, {
                    type: 'bar',
                    data: {
                        labels: weeks,
                        datasets: [{
                            label: 'Weekly Revenue',
                            data: sanitizedWeeklyRevenueData,
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderColor: 'rgba(75, 192, 192, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });

                // Booking Count Chart
                const countCtx = document.getElementById('countChart').getContext('2d');
                const countChart = new Chart(countCtx, {
                    type: 'line',
                    data: {
                        labels: weeks,
                        datasets: [{
                            label: 'Booking Count',
                            data: Array(4).fill(countData), // Filling the array to match the number of weeks
                            backgroundColor: 'rgba(153, 102, 255, 0.2)',
                            borderColor: 'rgba(153, 102, 255, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            } else {
                console.error('No data received from the API');
            }
        } catch (error) {
            console.error('Error fetching data:', error);
        }
    }

    fetchChartData();
</script>

<script src="/js/jquery-3.2.1.min.js"></script>
<script src="/js/jquery-migrate-3.0.0.js"></script>
<script src="/js/popper.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/jquery.waypoints.min.js"></script>
<script src="/js/jquery.stellar.min.js"></script>

<script src="/js/jquery.magnific-popup.min.js"></script>
<script src="/js/magnific-popup-options.js"></script>

<script src="/js/main.js"></script>

</body>
</html>
